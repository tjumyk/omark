<app-error [error]="error"></app-error>

<ng-container *ngIf="book">
  <div class="ui segment">
    <ng-template #system>System</ng-template>
    <div class="ui list horizontal">
      <div class="item">
        <div class="header">ID</div>
        {{book.id}}
      </div>
      <div class="item">
        <div class="header">Student</div>
        <app-user-mini-card [enablePopup]="false" [user]="book.student" *ngIf="book.student_id; else noStudent"></app-user-mini-card>
        <ng-template #noStudent>(No Student Info)</ng-template>
      </div>
      <div class="item">
        <div class="header">Created At</div>
        {{book.created_at | date: 'medium'}}
      </div>
    </div>
  </div>

  <div class="ui grid stackable">
    <div class="column twelve wide">
      <div class="ui grid two column">
        <div class="column" *ngFor="let page of book.pages; index as i">
          <app-answer-page-preview [page]="page" [pdfCache]="pdfCache" (click)="showAnnotator(i + 1)"></app-answer-page-preview>
        </div>
      </div>

      <div class="ui grid two column centered stackable">
        <div class="column">
          <div class="ui segment">
            <div class="ui top attached progress" *ngIf="addingPages">
              <div class="bar" [ngStyle]="{'width.%': addPagesProgress}"></div>
            </div>
            <form class="ui form" #f="ngForm" (ngSubmit)="addPages(inputFile.files)" [class.loading]="addingPages">
              <div class="field required">
                <label>File</label>
                <input type="file" name="file" accept="image/*,.pdf" required #inputFile multiple>
              </div>
              <button type="submit" class="ui button primary fluid"><i class="icon plus"></i> Add Pages</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="column four wide">
      <app-answer-book-markings-view *ngIf="!annotatorShown" [exam]="exam" [book]="book" (error)="error=$event"></app-answer-book-markings-view>
    </div>
  </div>

  <app-answer-book-annotator *ngIf="annotatorShown" [startPageIndex]="annotatorStartPageIndex" (closed)="hideAnnotator()"
                             [exam]="exam" [book]="book" [pdfCache]="pdfCache"></app-answer-book-annotator>
</ng-container>
